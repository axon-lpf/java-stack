# ğŸ”„ **G1 åƒåœ¾æ”¶é›†å™¨å»é‡æ“ä½œæ·±åº¦è§£æ**

## ğŸ¯ **G1 å»é‡æ“ä½œæ¦‚è¿°**

G1çš„å»é‡æ“ä½œä¸»è¦æŒ‡ **Stringå»é‡ (String Deduplication)**ï¼Œè¿™æ˜¯G1åƒåœ¾æ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦ä¼˜åŒ–ç‰¹æ€§ï¼Œç”¨äº**å‡å°‘å †å†…å­˜ä¸­é‡å¤å­—ç¬¦ä¸²å¯¹è±¡çš„å†…å­˜å ç”¨**ã€‚

## ğŸ“Š **å­—ç¬¦ä¸²é‡å¤é—®é¢˜çš„ç°çŠ¶**

```java
// å…¸å‹çš„å­—ç¬¦ä¸²é‡å¤åœºæ™¯
public class StringDuplicationProblem {
    
    public static void main(String[] args) {
        // æ¨¡æ‹ŸçœŸå®åº”ç”¨ä¸­çš„å­—ç¬¦ä¸²é‡å¤æƒ…å†µ
        demonstrateStringDuplication();
    }
    
    private static void demonstrateStringDuplication() {
        System.out.println("=== å­—ç¬¦ä¸²é‡å¤é—®é¢˜æ¼”ç¤º ===");
        
        // åœºæ™¯1: JSONè§£æäº§ç”Ÿçš„é‡å¤å­—ç¬¦ä¸²
        List<User> users = parseUsersFromJson();
        
        // åœºæ™¯2: é…ç½®æ–‡ä»¶è¯»å–äº§ç”Ÿçš„é‡å¤
        Properties config = loadConfiguration();
        
        // åœºæ™¯3: æ•°æ®åº“æŸ¥è¯¢ç»“æœçš„é‡å¤å­—æ®µ
        List<Order> orders = queryOrdersFromDatabase();
        
        // ğŸ’¡ åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œå¤§é‡å­—ç¬¦ä¸²å†…å®¹ç›¸åŒä½†å¯¹è±¡ä¸åŒ
        analyzeStringDuplication(users, config, orders);
    }
    
    private static void analyzeStringDuplication(List<User> users, 
                                               Properties config, 
                                               List<Order> orders) {
        
        Map<String, Integer> duplicateCount = new HashMap<>();
        
        // ç»Ÿè®¡é‡å¤çš„å­—ç¬¦ä¸²
        for (User user : users) {
            countDuplicate(duplicateCount, user.getStatus());    // "ACTIVE", "INACTIVE"
            countDuplicate(duplicateCount, user.getDepartment()); // "IT", "SALES", "HR"
            countDuplicate(duplicateCount, user.getCity());      // "Beijing", "Shanghai"
        }
        
        System.out.println("å­—ç¬¦ä¸²é‡å¤ç»Ÿè®¡:");
        duplicateCount.forEach((str, count) -> {
            if (count > 1) {
                System.out.println("'" + str + "' é‡å¤äº† " + count + " æ¬¡");
                System.out.println("  æµªè´¹å†…å­˜: " + (count - 1) * estimateStringSize(str) + " bytes");
            }
        });
        
        // ğŸ’¡ ç»“æœæ˜¾ç¤ºï¼šå¤§é‡å†…å­˜è¢«é‡å¤å­—ç¬¦ä¸²æµªè´¹
        System.out.println("âœ… G1 Stringå»é‡å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼");
    }
    
    private static void countDuplicate(Map<String, Integer> map, String str) {
        map.merge(str, 1, Integer::sum);
    }
    
    private static int estimateStringSize(String str) {
        // Stringå¯¹è±¡å¤´ + char[]æ•°ç»„ + å­—ç¬¦æ•°æ®
        return 16 + 16 + str.length() * 2;
    }
}
```

## ğŸ—ï¸ **G1 Stringå»é‡æ¶æ„å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    G1 String å»é‡å®Œæ•´æµç¨‹                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              1. å¯¹è±¡åˆ†é…é˜¶æ®µ                             â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  String s1 = new String("Hello");  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  String s2 = new String("Hello");  â”‚  å †å†…å­˜ä¸­       â”‚   â”‚ â”‚
â”‚  â”‚  String s3 = new String("World");  â”‚                 â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚String@1001  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚value="Hello"â”‚ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚String@1002  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚value="Hello"â”‚ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚String@1003  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚value="World"â”‚ â”‚   â”‚ â”‚
â”‚  â”‚                                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚
â”‚  â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              2. G1 GC æ‰«æé˜¶æ®µ                          â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  G1 åœ¨GCè¿‡ç¨‹ä¸­æ‰«æStringå¯¹è±¡ï¼š                          â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚          å»é‡å€™é€‰å¯¹è±¡è¯†åˆ«                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  âœ… String@1001: age >= threshold (é»˜è®¤3)          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  âœ… String@1002: age >= threshold                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  âŒ String@1003: åˆšåˆ›å»ºï¼Œage < threshold            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  ç­›é€‰æ¡ä»¶:                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ å¯¹è±¡å¹´é¾„ >= StringDeduplicationAgeThreshold    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ å­—ç¬¦ä¸²é•¿åº¦åˆç†ï¼ˆä¸æ˜¯æçŸ­æˆ–æé•¿ï¼‰                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ ä¸åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­                              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           3. å»é‡å“ˆå¸Œè¡¨æ„å»º                             â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚            Deduplication Table                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Hash("Hello") â†’ char[]{'H','e','l','l','o'} âœ…   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Hash("World") â†’ char[]{'W','o','r','l','d'}      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Hash("Java")  â†’ char[]{'J','a','v','a'}          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  ...                                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  ç‰¹ç‚¹ï¼š                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ å¼±å¼•ç”¨å­˜å‚¨char[]æ•°ç»„                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ åŸºäºå†…å®¹å“ˆå¸Œçš„å¿«é€ŸæŸ¥æ‰¾                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ è‡ªåŠ¨æ¸…ç†æœªä½¿ç”¨çš„æ¡ç›®                            â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              4. å»é‡æ‰§è¡Œé˜¶æ®µ                            â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  å¯¹äºString@1001å’ŒString@1002 (éƒ½æ˜¯"Hello"):            â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  Beforeå»é‡:                Afterå»é‡:                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚  â”‚String@1001  â”‚              â”‚String@1001  â”‚            â”‚ â”‚
â”‚  â”‚  â”‚value â”€â”€â”€â”€â”€â”€â†’â”¼â”€â”€â”€â”€â”         â”‚value â”€â”€â”€â”€â”€â”€â†’â”¼â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â†“         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚ â”‚
â”‚  â”‚  â”‚String@1002  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚String@1002  â”‚      â”‚     â”‚ â”‚
â”‚  â”‚  â”‚value â”€â”€â”€â”€â”€â”€â†’â”¼â†’â”‚char[]  â”‚   â”‚value â”€â”€â”€â”€â”€â”€â†’â”¼â”€â”€â”€â”€â”€â”€â”¤     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚"Hello" â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚ â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â†“     â”‚ â”‚
â”‚  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚                  â”‚char[]  â”‚                    â”‚char[]  â”‚ â”‚ â”‚
â”‚  â”‚                  â”‚"Hello" â”‚â† é‡å¤,è¢«GCå›æ”¶      â”‚"Hello" â”‚ â”‚ â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  ğŸ’¡ ç»“æœ: ä¸¤ä¸ªStringå¯¹è±¡å…±äº«åŒä¸€ä¸ªchar[]æ•°ç»„              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               5. å†…å­˜å›æ”¶é˜¶æ®µ                           â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  é‡å¤çš„char[]æ•°ç»„åœ¨ä¸‹æ¬¡GCæ—¶è¢«å›æ”¶:                       â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  â€¢ èŠ‚çœå†…å­˜ç©ºé—´                                         â”‚ â”‚
â”‚  â”‚  â€¢ æé«˜ç¼“å­˜å±€éƒ¨æ€§                                       â”‚ â”‚
â”‚  â”‚  â€¢ å‡å°‘GCå‹åŠ›                                          â”‚ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  ç»Ÿè®¡ä¿¡æ¯æ›´æ–°:                                          â”‚ â”‚
â”‚  â”‚  âœ… Total Deduplicated: 1                              â”‚ â”‚
â”‚  â”‚  âœ… Bytes Saved: 10 bytes                              â”‚ â”‚
â”‚  â”‚  âœ… Success Rate: 50%                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ **G1 Stringå»é‡çš„æ ¸å¿ƒå®ç°æœºåˆ¶**

### **1. å»é‡è§¦å‘æ¡ä»¶**

```java
// G1 å»é‡è§¦å‘çš„æ¡ä»¶åˆ¤æ–­ä¼ªä»£ç 
public class G1StringDeduplicationTrigger {
    
    private static final int DEFAULT_AGE_THRESHOLD = 3;
    private static final int MIN_STRING_LENGTH = 8;
    private static final int MAX_STRING_LENGTH = 1024;
    
    /**
     * åˆ¤æ–­Stringå¯¹è±¡æ˜¯å¦é€‚åˆå»é‡
     */
    public static boolean isDeduplicationCandidate(StringObject str) {
        // 1. å¯¹è±¡å¹´é¾„æ£€æŸ¥ - é¿å…å¯¹æ–°åˆ›å»ºçš„å¯¹è±¡å»é‡
        if (str.getAge() < DEFAULT_AGE_THRESHOLD) {
            return false;  // å¤ªæ–°ï¼Œå¯èƒ½å¾ˆå¿«å°±è¢«å›æ”¶
        }
        
        // 2. å­—ç¬¦ä¸²é•¿åº¦æ£€æŸ¥ - é¿å…å¤„ç†è¿‡çŸ­æˆ–è¿‡é•¿çš„å­—ç¬¦ä¸²
        int length = str.getValue().length;
        if (length < MIN_STRING_LENGTH || length > MAX_STRING_LENGTH) {
            return false;  // æ•ˆæœä¸æ˜æ˜¾æˆ–æˆæœ¬å¤ªé«˜
        }
        
        // 3. å¸¸é‡æ± æ£€æŸ¥ - å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä¸éœ€è¦å»é‡
        if (str.isInStringPool()) {
            return false;  // å¸¸é‡æ± å­—ç¬¦ä¸²å·²ç»æ˜¯å»é‡çš„
        }
        
        // 4. å·²å»é‡æ£€æŸ¥ - é¿å…é‡å¤å¤„ç†
        if (str.isAlreadyDeduplicated()) {
            return false;  // å·²ç»è¢«å»é‡è¿‡äº†
        }
        
        return true;
    }
    
    /**
     * G1 GCè¿‡ç¨‹ä¸­çš„å»é‡è°ƒåº¦
     */
    public static void scheduleDeduplication() {
        System.out.println("=== G1 å»é‡è°ƒåº¦é€»è¾‘ ===");
        
        // åœ¨ä»¥ä¸‹GCé˜¶æ®µæ‰§è¡Œå»é‡:
        // 1. Young GCåçš„å¹¶å‘æ ‡è®°é˜¶æ®µ
        // 2. Mixed GCè¿‡ç¨‹ä¸­
        // 3. Full GCè¿‡ç¨‹ä¸­
        
        if (isDeduplicationEnabled() && shouldRunDeduplication()) {
            executeStringDeduplication();
        }
    }
    
    private static boolean isDeduplicationEnabled() {
        // -XX:+UseStringDeduplication
        return System.getProperty("UseStringDeduplication", "false").equals("true");
    }
    
    private static boolean shouldRunDeduplication() {
        // åŸºäºå †ä½¿ç”¨ç‡ã€å»é‡æ•ˆæœç­‰å†³å®š
        double heapUsageRatio = getCurrentHeapUsage();
        double lastDeduplicationEffectiveness = getLastDeduplicationStats();
        
        return heapUsageRatio > 0.6 && lastDeduplicationEffectiveness > 0.1;
    }
}
```

### **2. å»é‡å“ˆå¸Œè¡¨çš„å®ç°**

```java
import java.lang.ref.WeakReference;
import java.util.concurrent.ConcurrentHashMap;

// G1 å»é‡å“ˆå¸Œè¡¨çš„æ ¸å¿ƒå®ç°
public class StringDeduplicationTable {
    
    // ä½¿ç”¨å¼±å¼•ç”¨å­˜å‚¨char[]æ•°ç»„ï¼Œå…è®¸GCè‡ªåŠ¨æ¸…ç†
    ```java
    private ConcurrentHashMap<Integer, WeakReference<char[]>> deduplicationTable;
    
    public StringDeduplicationTable() {
        this.deduplicationTable = new ConcurrentHashMap<>();
    }
    
    /**
     * å°è¯•å»é‡å­—ç¬¦ä¸²
     */
    public char[] deduplicate(String str) {
        char[] value = str.getValue();
        int hashCode = calculateHash(value);
        
        // 1. æŸ¥æ‰¾å·²å­˜åœ¨çš„ç›¸åŒå†…å®¹
        WeakReference<char[]> existingRef = deduplicationTable.get(hashCode);
        if (existingRef != null) {
            char[] existing = existingRef.get();
            if (existing != null && arraysEqual(value, existing)) {
                // âœ… æ‰¾åˆ°ç›¸åŒå†…å®¹ï¼Œè¿”å›å·²å­˜åœ¨çš„æ•°ç»„
                return existing;
            } else {
                // å¼±å¼•ç”¨å·²è¢«å›æ”¶ï¼Œç§»é™¤æ¡ç›®
                deduplicationTable.remove(hashCode);
            }
        }
        
        // 2. é¦–æ¬¡é‡åˆ°æ­¤å†…å®¹ï¼ŒåŠ å…¥å“ˆå¸Œè¡¨
        deduplicationTable.put(hashCode, new WeakReference<>(value));
        return value;
    }
    
    private int calculateHash(char[] array) {
        // åŸºäºå†…å®¹çš„å“ˆå¸Œè®¡ç®—
        int hash = 0;
        for (char c : array) {
            hash = 31 * hash + c;
        }
        return hash;
    }
}
```

## ğŸ›ï¸ **G1 å»é‡ç›¸å…³JVMå‚æ•°**

```bash
# å¯ç”¨G1 Stringå»é‡
-XX:+UseG1GC
-XX:+UseStringDeduplication

# å»é‡ç›¸å…³è°ƒä¼˜å‚æ•°
-XX:StringDeduplicationAgeThreshold=3     # å¯¹è±¡å¹´é¾„é˜ˆå€¼(é»˜è®¤3)
-XX:+PrintStringDeduplicationStatistics  # æ‰“å°å»é‡ç»Ÿè®¡ä¿¡æ¯
-XX:StringDeduplicationTableSizeLimit=1000000  # å“ˆå¸Œè¡¨å¤§å°é™åˆ¶
```

## ğŸ“ˆ **å»é‡æ•ˆæœç›‘æ§ç¤ºä¾‹**

```java
// ç›‘æ§å»é‡æ•ˆæœ
public class DeduplicationMonitor {
    public static void printStats() {
        System.out.println("=== G1 Stringå»é‡ç»Ÿè®¡ ===");
        System.out.println("Total Inspected: 1,000,000 strings");
        System.out.println("Total Deduplicated: 250,000 strings");  
        System.out.println("Memory Saved: 15.2 MB");
        System.out.println("Success Rate: 25%");
        System.out.println("âœ… æ˜¾è‘—å‡å°‘äº†å†…å­˜å ç”¨");
    }
}
```

## ğŸ¯ **æ ¸å¿ƒæ€»ç»“**

### **âœ… G1å»é‡çš„ä¼˜åŠ¿**
- **è‡ªåŠ¨åŒ–**: æ— éœ€ä»£ç ä¿®æ”¹ï¼ŒJVMè‡ªåŠ¨å¤„ç†
- **æ™ºèƒ½åŒ–**: åŸºäºå¯¹è±¡å¹´é¾„å’Œä½¿ç”¨æ¨¡å¼çš„æ™ºèƒ½é€‰æ‹©
- **å®‰å…¨æ€§**: ä½¿ç”¨å¼±å¼•ç”¨ï¼Œä¸å½±å“æ­£å¸¸GC
- **é€æ˜æ€§**: å¯¹åº”ç”¨ç¨‹åºå®Œå…¨é€æ˜

### **âš ï¸ æ³¨æ„äº‹é¡¹**
- **CPUå¼€é”€**: å»é‡è¿‡ç¨‹æ¶ˆè€—é¢å¤–CPU
- **é€‚ç”¨åœºæ™¯**: ä¸»è¦é€‚åˆæœ‰å¤§é‡é‡å¤å­—ç¬¦ä¸²çš„åº”ç”¨
- **æ•ˆæœä¾èµ–**: é‡å¤åº¦è¶Šé«˜æ•ˆæœè¶Šæ˜æ˜¾

**G1çš„å»é‡æ“ä½œé€šè¿‡æ™ºèƒ½è¯†åˆ«é‡å¤å­—ç¬¦ä¸²å†…å®¹ï¼Œè®©å¤šä¸ªStringå¯¹è±¡å…±äº«åŒä¸€ä¸ªchar[]æ•°ç»„ï¼Œä»è€Œæ˜¾è‘—å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œæ˜¯ç°ä»£JVMå†…å­˜ä¼˜åŒ–çš„é‡è¦æŠ€æœ¯ï¼**