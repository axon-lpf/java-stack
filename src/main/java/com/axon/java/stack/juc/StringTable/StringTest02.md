# ğŸ” **å­—ç¬¦ä¸²ç¼–è¯‘æœŸä¼˜åŒ–åˆ†æ**

## ğŸ“ **ä»£ç åˆ†æ**

```java
private final static String fin = "a";  // ğŸ”‘ å…³é”®ï¼šfinal ç¼–è¯‘æœŸå¸¸é‡
private static String x = "a";          // âš ï¸ éfinalï¼Œè¿è¡ŒæœŸå˜é‡

public static void demo04(){
    String s1 = fin + "b";    // ç¼–è¯‘æœŸä¼˜åŒ– â†’ "ab"
    String s2 = "a" + "b";    // ç¼–è¯‘æœŸä¼˜åŒ– â†’ "ab"  
    String s3 = x + "b";      // è¿è¡ŒæœŸæ‹¼æ¥ â†’ new StringBuilder

    System.out.println(s1 == s2);  // true
    System.out.println(s2 == s3);  // false
    System.out.println(s1 == s3);  // false
}
```

## ğŸ¯ **æ ¸å¿ƒåŸç†è§£é‡Š**

### **1. ç¼–è¯‘æœŸå¸¸é‡æŠ˜å ï¼ˆConstant Foldingï¼‰**

```java
// ç¼–è¯‘å‰
String s1 = fin + "b";    // finæ˜¯finalçš„
String s2 = "a" + "b";    // å­—é¢é‡æ‹¼æ¥

// ç¼–è¯‘åçš„å­—èŠ‚ç ç­‰æ•ˆäº
String s1 = "ab";         // ç›´æ¥ä¼˜åŒ–ä¸ºå­—é¢é‡
String s2 = "ab";         // ç›´æ¥ä¼˜åŒ–ä¸ºå­—é¢é‡
```

### **2. è¿è¡ŒæœŸå­—ç¬¦ä¸²æ‹¼æ¥**

```java
// ç¼–è¯‘å‰  
String s3 = x + "b";      // xä¸æ˜¯finalçš„

// ç¼–è¯‘åçš„å­—èŠ‚ç ç­‰æ•ˆäº
String s3 = new StringBuilder().append(x).append("b").toString();
```

## ğŸ”¬ **å­—èŠ‚ç åˆ†æ**

### **ç¼–è¯‘æœŸä¼˜åŒ–çš„æ¡ä»¶**
| æ¡ä»¶ | ç¤ºä¾‹ | æ˜¯å¦ä¼˜åŒ– | åŸå›  |
|------|------|----------|------|
| å­—é¢é‡æ‹¼æ¥ | `"a" + "b"` | âœ… | ç¼–è¯‘æœŸå·²çŸ¥ |
| finalå˜é‡æ‹¼æ¥ | `final String s="a"; s+"b"` | âœ… | ç¼–è¯‘æœŸå¸¸é‡ |
| éfinalå˜é‡æ‹¼æ¥ | `String s="a"; s+"b"` | âŒ | è¿è¡ŒæœŸæ‰èƒ½ç¡®å®š |
| finalä½†éç¼–è¯‘æœŸå¸¸é‡ | `final String s=getString(); s+"b"` | âŒ | è¿è¡ŒæœŸæ‰èƒ½ç¡®å®š |

## ğŸ—ºï¸ **å†…å­˜ç»“æ„å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç¼–è¯‘æœŸå¤„ç†                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  fin + "b"  â†’  ç¼–è¯‘å™¨ä¼˜åŒ–  â†’  "ab"                         â”‚
â”‚  "a" + "b"  â†’  ç¼–è¯‘å™¨ä¼˜åŒ–  â†’  "ab"                         â”‚
â”‚  x + "b"    â†’  ä¿æŒåŸæ ·   â†’  StringBuilderæ‹¼æ¥              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è¿è¡ŒæœŸå†…å­˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         å †å†…å­˜ (Heap)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   Young Generation                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”‚  StringBuilder.toString()åˆ›å»ºçš„Stringå¯¹è±¡           â”‚ â”‚
â”‚  â”‚  â”‚  value: ['a','b']                                  â”‚ â”‚
â”‚  â”‚  â”‚  åœ°å€: @2001            â†â”€â”€â”€â”€â”€â”                    â”‚ â”‚  
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              å­—ç¬¦ä¸²å¸¸é‡æ±  (StringTable)                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”‚  Stringå¯¹è±¡ "ab"  â†â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚  â”‚  â”‚  value: ['a','b']       â”‚                          â”‚ â”‚
â”‚  â”‚  â”‚  åœ°å€: @2002            â”‚                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
æ ˆå†…å­˜ (Stack):                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ s1      â†’ @2002        â”‚  â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ s2      â†’ @2002        â”‚  â”€â”€â”€â”€â”€â”€â”€â” æŒ‡å‘åŒä¸€ä¸ªå¸¸é‡æ± å¯¹è±¡
â”‚ s3      â†’ @2001        â”‚  â”€â”€â”€â”€â”€â”€â”€â”˜ æŒ‡å‘å †ä¸­çš„æ–°å¯¹è±¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–¹æ³•åŒº (Method Area):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fin     â†’ "a" (å¸¸é‡)    â”‚
â”‚ x       â†’ "a" (å˜é‡)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š **æ‰§è¡Œè¿‡ç¨‹è¯¦è§£**

### **Step 1: ç¼–è¯‘æœŸå¤„ç†**
```java
// æºä»£ç 
String s1 = fin + "b";    // finæ˜¯final staticï¼Œå€¼ä¸º"a"
String s2 = "a" + "b";    // å­—é¢é‡æ‹¼æ¥
String s3 = x + "b";      // xæ˜¯æ™®é€šå˜é‡

// ç¼–è¯‘å™¨ä¼˜åŒ–å
String s1 = "ab";         // ä¼˜åŒ–ä¸ºå­—é¢é‡
String s2 = "ab";         // ä¼˜åŒ–ä¸ºå­—é¢é‡  
String s3 = new StringBuilder().append(x).append("b").toString();
```

### **Step 2: è¿è¡ŒæœŸæ‰§è¡Œ**
```java
// s1å’Œs2ç›´æ¥ä»å¸¸é‡æ± è·å–"ab"å¼•ç”¨
s1 â†’ å¸¸é‡æ± ä¸­çš„"ab"å¯¹è±¡ (@2002)
s2 â†’ å¸¸é‡æ± ä¸­çš„"ab"å¯¹è±¡ (@2002)

// s3é€šè¿‡StringBuilderåˆ›å»ºæ–°çš„Stringå¯¹è±¡
StringBuilder sb = new StringBuilder();
sb.append(x);      // append("a")
sb.append("b");    // append("b")
s3 = sb.toString(); // åœ¨å †ä¸­åˆ›å»ºæ–°çš„"ab"å¯¹è±¡ (@2001)
```

## ğŸ¯ **å…³é”®çŸ¥è¯†ç‚¹**

### **1. finalå˜é‡çš„ç¼–è¯‘æœŸå¸¸é‡è¦æ±‚**
```java
// âœ… ç¼–è¯‘æœŸå¸¸é‡ - ä¼šè¢«ä¼˜åŒ–
private final static String fin1 = "a";
private final static int num = 10;
private final static String fin2 = "prefix";

// âŒ éç¼–è¯‘æœŸå¸¸é‡ - ä¸ä¼šè¢«ä¼˜åŒ–  
private final static String fin3 = getString();  // æ–¹æ³•è°ƒç”¨
private final static String fin4 = System.getProperty("user.name");
```

### **2. å­—ç¬¦ä¸²æ‹¼æ¥çš„æ€§èƒ½å·®å¼‚**
```java
// é«˜æ€§èƒ½ï¼šç¼–è¯‘æœŸä¼˜åŒ–ï¼Œç›´æ¥ä½¿ç”¨å¸¸é‡æ± 
String s1 = "a" + "b" + "c";  // ç¼–è¯‘åï¼šString s1 = "abc";

// ä½æ€§èƒ½ï¼šè¿è¡ŒæœŸæ‹¼æ¥ï¼Œåˆ›å»ºå¤šä¸ªå¯¹è±¡
String a = "a", b = "b", c = "c";
String s2 = a + b + c;  // åˆ›å»ºStringBuilder + è°ƒç”¨toString()
```

## ğŸ“ˆ **æ€§èƒ½å¯¹æ¯”**

| æ‹¼æ¥æ–¹å¼ | å¯¹è±¡åˆ›å»ºæ•°é‡ | æ€§èƒ½ | æ¨èåœºæ™¯ |
|----------|--------------|------|----------|
| ç¼–è¯‘æœŸä¼˜åŒ– | 1ä¸ªï¼ˆå¸¸é‡æ± ï¼‰ | ğŸš€ æœ€é«˜ | å·²çŸ¥å­—ç¬¦ä¸²æ‹¼æ¥ |
| StringBuilder | 2ä¸ªï¼ˆStringBuilder+Stringï¼‰ | ğŸƒ é«˜ | å¤æ‚æ‹¼æ¥é€»è¾‘ |
| String + è¿ç®—ç¬¦ | å¤šä¸ª | ğŸŒ ä½ | é¿å…ä½¿ç”¨ |

## âœ… **æœ€ç»ˆç»“æœ**

```java
System.out.println(s1 == s2);  // true  - éƒ½æŒ‡å‘å¸¸é‡æ± åŒä¸€å¯¹è±¡
System.out.println(s2 == s3);  // false - s2æŒ‡å‘å¸¸é‡æ± ï¼Œs3æŒ‡å‘å †
System.out.println(s1 == s3);  // false - s1æŒ‡å‘å¸¸é‡æ± ï¼Œs3æŒ‡å‘å †
```

**æ ¸å¿ƒæ€»ç»“ï¼šfinalå˜é‡å‚ä¸çš„å­—ç¬¦ä¸²æ‹¼æ¥ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ä¸ºå¸¸é‡æ± æ“ä½œï¼Œè€Œéfinalå˜é‡åˆ™ä¼šä½¿ç”¨StringBuilderè¿›è¡Œè¿è¡ŒæœŸæ‹¼æ¥ï¼**