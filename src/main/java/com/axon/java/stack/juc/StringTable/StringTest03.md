# ğŸ” **`String s3=x+"b"` æ˜¯å¦ä¼šæ”¾å…¥å¸¸é‡æ± ï¼Ÿ**

## âŒ **ç­”æ¡ˆï¼šä¸ä¼šè‡ªåŠ¨æ”¾å…¥å¸¸é‡æ± **

```java
private static String x = "a";

public static void demo04(){
    String s3 = x + "b";  // âŒ ä¸ä¼šè‡ªåŠ¨è¿›å…¥å¸¸é‡æ± 
}
```

## ğŸ¯ **è¯¦ç»†è§£é‡Š**

### **1. ç¼–è¯‘å™¨å¤„ç†è¿‡ç¨‹**

```java
// æºä»£ç 
String s3 = x + "b";

// ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼ˆå­—èŠ‚ç ç­‰æ•ˆï¼‰
String s3 = new StringBuilder()
    .append(x)
    .append("b")
    .toString();
```

### **2. StringBuilder.toString() æºç åˆ†æ**

```java
// StringBuilder.toString() æ–¹æ³•å®ç°
@Override
public String toString() {
    // Create a copy, don't share the array
    return new String(value, 0, count);  // ğŸ”‘ å…³é”®ï¼šç›´æ¥new String()
}
```

## ğŸ—ºï¸ **å†…å­˜åˆ†é…è¿‡ç¨‹å›¾**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ‰§è¡Œ x + "b" çš„å†…å­˜å˜åŒ–                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         å †å†…å­˜ (Heap)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 1: åˆ›å»º StringBuilder å¯¹è±¡                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”‚  StringBuilder@3001                                â”‚ â”‚
â”‚  â”‚  â”‚  value: char[16]                                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  Step 2: append(x) â†’ append("a")                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”‚  StringBuilder@3001                                â”‚ â”‚
â”‚  â”‚  â”‚  value: ['a', '\0', '\0', ...]                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  Step 3: append("b")                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”‚  StringBuilder@3001                                â”‚ â”‚
â”‚  â”‚  â”‚  value: ['a', 'b', '\0', ...]                      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚  Step 4: toString() â†’ new String()                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”‚  String@3002 â†â”€â”€â”€â”€ s3 æŒ‡å‘è¿™é‡Œ                     â”‚ â”‚
â”‚  â”‚  â”‚  value: ['a', 'b']  âš ï¸ åœ¨å †ä¸­ï¼Œä¸åœ¨å¸¸é‡æ±           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              å­—ç¬¦ä¸²å¸¸é‡æ±  (StringTable)                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  â”‚  "a" â†’ String@3003 (xå˜é‡æŒ‡å‘)                     â”‚ â”‚
â”‚  â”‚  â”‚  "b" â†’ String@3004 (å­—é¢é‡)                        â”‚ â”‚
â”‚  â”‚  â”‚  âŒ æ²¡æœ‰ "ab" çš„è®°å½•                                â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š **å¯¹æ¯”ä¸åŒçš„å­—ç¬¦ä¸²åˆ›å»ºæ–¹å¼**

| åˆ›å»ºæ–¹å¼ | æ˜¯å¦è¿›å¸¸é‡æ±  | å†…å­˜ä½ç½® | ç¤ºä¾‹ |
|----------|--------------|----------|------|
| å­—é¢é‡ | âœ… è‡ªåŠ¨è¿›å…¥ | å¸¸é‡æ±  | `String s = "ab";` |
| ç¼–è¯‘æœŸå¸¸é‡æ‹¼æ¥ | âœ… è‡ªåŠ¨è¿›å…¥ | å¸¸é‡æ±  | `final String a="a"; String s=a+"b";` |
| è¿è¡ŒæœŸå˜é‡æ‹¼æ¥ | âŒ ä¸è¿›å…¥ | å †å†…å­˜ | `String a="a"; String s=a+"b";` |
| new String() | âŒ ä¸è¿›å…¥ | å †å†…å­˜ | `String s = new String("ab");` |

## ğŸ§ª **éªŒè¯ä»£ç **

```java
public class StringPoolTest {
    private static String x = "a";
    
    public static void main(String[] args) {
        // è¿è¡ŒæœŸæ‹¼æ¥ï¼Œä¸è¿›å¸¸é‡æ± 
        String s1 = x + "b";        // å †ä¸­åˆ›å»º
        
        // å­—é¢é‡ï¼Œè‡ªåŠ¨è¿›å¸¸é‡æ± 
        String s2 = "ab";           // å¸¸é‡æ± è·å–
        
        // éªŒè¯æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡
        System.out.println("s1 == s2: " + (s1 == s2));  // false
        System.out.println("s1.equals(s2): " + (s1.equals(s2)));  // true
        
        // ğŸ”‘ é€šè¿‡ intern() å°† s1 åŠ å…¥å¸¸é‡æ± 
        String s1Intern = s1.intern();
        System.out.println("s1.intern() == s2: " + (s1Intern == s2));  // true
        
        // éªŒè¯å†…å­˜åœ°å€
        System.out.println("s1 hashCode: " + System.identityHashCode(s1));
        System.out.println("s2 hashCode: " + System.identityHashCode(s2));
        System.out.println("s1.intern() hashCode: " + System.identityHashCode(s1Intern));
    }
}
```

## ğŸ”„ **å¦‚ä½•å°†è¿è¡ŒæœŸåˆ›å»ºçš„å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ï¼Ÿ**

```java
private static String x = "a";

public static void demo() {
    // Step 1: è¿è¡ŒæœŸæ‹¼æ¥ï¼Œåˆ›å»ºå †å¯¹è±¡
    String s3 = x + "b";           // å †ä¸­@3002
    
    // Step 2: æ˜¾å¼è°ƒç”¨ intern() æ”¾å…¥å¸¸é‡æ± 
    String s3Intern = s3.intern(); // å¸¸é‡æ± ä¸­å­˜å‚¨ "ab"
    
    // Step 3: åç»­å­—é¢é‡è·å–å¸¸é‡æ± å¼•ç”¨
    String s4 = "ab";              // ä»å¸¸é‡æ± è·å–
    
    System.out.println(s3 == s4);        // false (s3åœ¨å †ï¼Œs4åœ¨å¸¸é‡æ± )
    System.out.println(s3Intern == s4);  // true  (éƒ½æŒ‡å‘å¸¸é‡æ± )
}
```

## ğŸ“ˆ **æ€§èƒ½å½±å“**

```java
// âŒ ä½æ•ˆï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡
for (int i = 0; i < 1000; i++) {
    String s = x + "suffix";  // 1000ä¸ªä¸åŒçš„å †å¯¹è±¡
}

// âœ… é«˜æ•ˆï¼šå¤ç”¨StringBuilder
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 1000; i++) {
    sb.setLength(0);  // é‡ç½®
    sb.append(x).append("suffix");
    String s = sb.toString();
}

// âœ… æœ€é«˜æ•ˆï¼šå¦‚æœæ˜¯å·²çŸ¥å­—ç¬¦ä¸²ï¼Œç›´æ¥ä½¿ç”¨å¸¸é‡
final String X = "a";  // ç¼–è¯‘æœŸå¸¸é‡
String s = X + "suffix";  // ç¼–è¯‘æœŸä¼˜åŒ–ä¸º "asuffix"
```

## ğŸ¯ **æ ¸å¿ƒæ€»ç»“**

1. **`String s3 = x + "b"` ä¸ä¼šè‡ªåŠ¨è¿›å…¥å¸¸é‡æ± **
2. **StringBuilder.toString() æ€»æ˜¯åœ¨å †ä¸­åˆ›å»ºæ–°å¯¹è±¡**
3. **åªæœ‰å­—é¢é‡å’Œç¼–è¯‘æœŸå¸¸é‡æ‹¼æ¥æ‰ä¼šè‡ªåŠ¨è¿›å…¥å¸¸é‡æ± **
4. **è¦å°†è¿è¡ŒæœŸåˆ›å»ºçš„å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ï¼Œéœ€è¦æ˜¾å¼è°ƒç”¨ `intern()` æ–¹æ³•**

**è®°ä½ï¼šåªæœ‰ç¼–è¯‘å™¨èƒ½ç¡®å®šçš„å­—ç¬¦ä¸²å€¼æ‰ä¼šè‡ªåŠ¨è¿›å…¥å¸¸é‡æ± ï¼**