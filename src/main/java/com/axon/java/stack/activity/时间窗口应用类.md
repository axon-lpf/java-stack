以下是基于提供的代码生成的 Markdown 文档：

# SlidingWindowRateLimiter 类文档

## 概述

`SlidingWindowRateLimiter` 是一个使用滑动窗口算法实现的限流器。它利用 Redis 的有序集合（Sorted Set）来跟踪和限制请求频率。

## 类定义

```java
@Component
public class SlidingWindowRateLimiter
```

该类被标记为 Spring 组件，可以通过依赖注入使用。

## 依赖

- `RedissonClient`: 用于 Redis 操作
- Spring Framework

## 主要方法

### isAllowed

```java

package com.netease.lofter.benefit.mini.util;

import org.redisson.api.RScoredSortedSet;
import org.redisson.api.RedissonClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import java.util.function.LongConsumer;

/**
 * @author：liupengfei
 * @date：2025/9/9
 * @description：
 */
@Component
public class SlidingWindowRateLimiter {

    @Autowired
    private RedissonClient redissonClient;


    private static final String KEY_PREFIX = "benefit-new:rateLimiter:";


    public boolean isAllowed(String key, String identifier, int windowSizeInSeconds, int limit) {
        RScoredSortedSet<String> zset = getZSet(key);

        long now = System.currentTimeMillis();
        long windowStart = now - (windowSizeInSeconds * 1000L);

        //移除窗口外的旧数据
        zset.removeRangeByScore(0, true, windowStart, false);

        //获取当前窗口内的请求数
        long count = zset.count(windowStart, true, now, true);

        //如果未超过限制，添加当前请求
        if (count < limit) {
            zset.add(now, identifier + ":" + now);
            return true;
        }

        return false;
    }


    public void addRequest(String key, String identifier,int windowSizeInSeconds, LongConsumer  longConsumer) {
        RScoredSortedSet<String> zset = getZSet(key);

        long now = System.currentTimeMillis();
        long windowStart = now - (windowSizeInSeconds * 1000L);

        // 移除窗口外的旧数据
        zset.removeRangeByScore(0, true, windowStart, false);

        zset.add(now, identifier + ":" + now);

        // 获取当前窗口内的请求数
        long count = zset.count(windowStart, true, now, true);

        longConsumer.accept(count);

    }

    private RScoredSortedSet<String> getZSet(String key) {
        return redissonClient.getScoredSortedSet(KEY_PREFIX + key);
    }
}
```

检查请求是否被允许通过限流器。

参数:
- `key`: 限流器的唯一标识
- `identifier`: 请求的唯一标识
- `windowSizeInSeconds`: 滑动窗口的大小（秒）
- `limit`: 在窗口期内允许的最大请求数

返回:
- `true` 如果请求被允许
- `false` 如果请求被限流

### addRequest

```java
public void addRequest(String key, String identifier, int windowSizeInSeconds, LongConsumer longConsumer)
```

添加一个请求到限流器，并执行回调函数。

参数:
- `key`: 限流器的唯一标识
- `identifier`: 请求的唯一标识
- `windowSizeInSeconds`: 滑动窗口的大小（秒）
- `longConsumer`: 回调函数，接收当前窗口内的请求数

## 私有方法

### getZSet

```java
private RScoredSortedSet<String> getZSet(String key)
```

获取与给定键关联的 Redis 有序集合。

## 实现细节

- 使用 Redis 的有序集合来存储请求记录
- 每个请求以时间戳为分数存储在有序集合中
- 在检查限流时，会先清理过期的请求记录
- 通过计算当前时间窗口内的请求数来决定是否允许新的请求

## 注意事项

- 确保 Redis 服务器有足够的内存来存储请求记录
- 合理设置窗口大小和限制，以平衡系统性能和请求限制
- 该实现是基于 Redisson 客户端的，确保正确配置 Redisson

## 使用示例

```java
@Autowired
private SlidingWindowRateLimiter rateLimiter;

public void someMethod() {
    String key = "user:123";
    String identifier = "action:login";
    int windowSize = 60; // 60 seconds
    int limit = 10; // 10 requests per minute

    if (rateLimiter.isAllowed(key, identifier, windowSize, limit)) {
        // 处理请求
    } else {
        // 请求被限流，返回错误信息
    }
}
```

这个文档提供了 `SlidingWindowRateLimiter` 类的概览、主要方法说明、实现细节和使用示例。它应该能帮助开发者理解和使用这个限流器组件。